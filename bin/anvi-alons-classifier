#!/usr/bin/env python3
# -*- coding: utf-8
# pylint: disable=line-too-long

import sys

import anvio
import anvio.alonsclassifier as alonsclassifier

from anvio.errors import ConfigError, FilesNPathsError


__author__ = "Alon Shaiber"
__copyright__ = "Copyright 2017, The anvio Project"
__credits__ = []
__license__ = "GPL 3.0"
__version__ = anvio.__version__
__maintainer__ = "Alon Shaiber"
__email__ = "alon.shaiber@gmail.com"


def main(args):
    classifier = alonsclassifier.AlonsClassifier(args)
    classifier.classify()


if __name__ == '__main__':
    import argparse
    parser = argparse.ArgumentParser(description="A program to classify genes according to coverage across multiple metagenomes")
    parser.add_argument('-d', '--data-file', metavar='FILE', help='input table of coverage values of '
                                                                               'genes in samples')
    parser.add_argument('-a', '--alpha', metavar='NUM', dest='alpha', type=float, default=0.8,
                        help='portion of TSC genes required to decide a genome is detected in a sample')
    parser.add_argument('-b', '--beta', metavar='NUM', dest='beta', type=float, default=1,
                        help='Weight of the number of non-taxon-specific genes in the loss function (default = 1). '
                             'This means that if the adjusted standard deviation of a gene is greater than beta, '
                             'then the gene will be classified as non-taxon-specific')
    parser.add_argument('-g', '--gamma', metavar='NUM', dest='gamma', type=float, default=2,
                        help='This is used to define detection of genes. It is the number of standard deviation below '
                             'the mean value of the taxon specific genes for which a gene is still considered detected')
    parser.add_argument('-e', '--eta', metavar='NUM', dest='eta', type=float, default=0.95,
                        help='Treshold for deciding whether a gene is core or accessory (default is 0.95, hence if a '
                             'gene is detected in at least 95%% of the samples (in which the genome is detected) then '
                             'it is considered core')
    parser.add_argument('-o', '--output', metavar='FILE', help='Output file for classes information')
    parser.add_argument('-s', '--sample-detection-output', metavar='FILE', help='Output file '
                                                                                   'for sample detection information')
    parser.add_argument('-A', '--additional-layers', metavar='FILE', dest='additional_layers_to_append', default=None,
                        help='An additional layer file to append to the one created by the algorithm')
    parser.add_argument('-S', '--samples-information', metavar='FILE', dest='samples_information_to_append',
                        default=None,
                        help='A samples information file to append to the one created by the algorithm')
    args = parser.parse_args()

    try:
        main(args)
    except ConfigError as e:
        print(e)
        sys.exit(-1)
    except FilesNPathsError as e:
        print(e)
        sys.exit(-2)
