<html>

<head>
    <title>Structure Display</title>
    <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
    <script type='text/javascript' src='js/utils.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/bootstrap-slider.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.0.0/css/bootstrap-slider.css" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="lib/colpick/colpick.css" type="text/css" />
    <link rel="stylesheet" href="lib/toastr/build/toastr.min.css" type="text/css" />
    <link rel="stylesheet" href="css/structure.css" />
    <script type="text/javascript" src="lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="lib/randomColor/randomColor.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/arose/ngl/v0.10.4/dist/ngl.js"></script>
    <script type="text/javascript" src="lib/colpick/colpick.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>
    <script src="https://fastcdn.org/FileSaver.js/1.1.20151003/FileSaver.min.js"></script>
    <script type="text/javascript" src="lib/toastr/build/toastr.min.js"></script>
    <script type="text/javascript" src="js/constants.js"></script>
    <script type="text/javascript" src="js/structure.js"></script>
</head>

<body>
    <div class="overlay">
        <div class="loading-gif-container">
            <img src="images/spinning_dna.gif" width="120" /><br />loading...
        </div>
    </div>
    <div class="container-fluid parent-container">
        <div id="ngl-tooltip" class="ngl-tooltip"></div>
        <div class="row">
            <div class="col-md-3 sidebar">
                <ul class="nav nav-tabs"  role="tablist">
                  <li role="presentation" class="active"><a href="#tab_main" aria-controls="tab_main" role="tab" data-toggle="tab"><span class="settings-header"><h5>Main</h5></span></a></li>
                  <li role="presentation"><a href="#tab_filters" aria-controls="tab_filters" role="tab" data-toggle="tab"><span class="settings-header"><h5>Filters</h5></span></a></li>
                  <li role="presentation"><a href="#tab_views" aria-controls="tab_views" role="tab" data-toggle="tab"><span class="settings-header"><h5>Views</h5></span></a></li>
                  <li role="presentation"><a href="#tab_summary" aria-controls="tab_summary" role="tab" data-toggle="tab"><span class="settings-header"><h5>Output</h5></span></a></li>
                </ul>
                <div class="tab-content">
                    <div id="tab_main" role="tabpanel" class="tab-pane fade in active">
                        <span class="settings-header"><h4>Gene</h4></span>
                        <div class="widget">
                            <div class="row">
                                <div class="col-md-4 form-row-padding">
                                    <label class="settings-label">Gene ID:</label>
                                </div>
                                <div class="col-md-8 form-row-padding">
                                    <select class="form-control" serialize="true" id="gene_callers_id_list" style="width: 100%;"></select>
                                </div>
                            </div>
                        </div>
                        <div class="widget">
                            <div class="row">
                                <div id="gene_function_info" class="col-md-12 form-row-padding"></div>
                            </div>
                        </div>
                        <span class="settings-header"><h4>Variant Type</h4></span>
                        <div class="widget">
                            <div class="row">
                                <div class="col-md-4 form-row-padding">
                                    <label class="col-md-4 settings-label">Engine:</label>
                                </div>
                                <div class="col-md-8 form-row-padding">
                                    <div id="engine_list"></div>
                                </div>
                            </div>
                        </div>
                        <span class="settings-header"><h4>Grouping</h4></span>
                        <div class="widget">
                            <div class="row">
                                <div class="col-md-4 form-row-padding">
                                    <label class="col-md-4 settings-label">Category:</label>
                                </div>
                                <div class="col-md-8 form-row-padding">
                                    <select class="form-control" serialize="true" id="sample_groups_list">

                                    </select>
                                </div>
                                <div class="clearfix"></div>
                                <div class="alert alert-danger" role="alert" style="margin: 10px; display: none;" id="maximum_ngl_widgets_error">You can only select up to 16 groups at a time. Unselect some to add more.</div>
                                <div class="clearfix"></div>
                            </div>
                            <div id="sample_groups">

                            </div>
                        </div>
                        <span class="settings-header"><h4>Session</h4></span>
                        <div class="btn-group" role="group" style="margin-bottom: 0px; width: 100%;">
                        <button type="button" class="btn btn-default btn-sm" style="width: 50%;" onclick="showLoadStateWindow();" data-help="load-state-button" data-original-title="" title=""><span class="glyphicon glyphicon-floppy-open" aria-hidden="true"></span> Load State</button>
                        <button type="button" class="btn btn-default btn-sm" style="width: 50%;" onclick="showSaveStateWindow();" data-help="save-state-button"><span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span> Save State</button> 
                    </div>
                    </div>
                    <div id="tab_filters" role="tabpanel" class="tab-pane fade">
                        <div id="controls">

                        </div>
                    </div>
                    <div id="tab_views" role="tabpanel" class="tab-pane fade">
                        <span class="settings-header"><h4>Variants</h4></span>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Color</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Rule: </label>
                            <div class="col-md-8">
                                <select id="color_type" onchange="if ($(this).val() == 'Static') { $('.static-color').show(); $('.dynamic-color').hide(); } else { $('.static-color').hide(); $('.dynamic-color').show(); }; draw_variability();">
                                    <option>Static</option>
                                    <option>Dynamic</option>
                                </select>
                            </div>
                        </div>
                        <div class="static-color">
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label">Color: </label>
                                <div class="col-md-8"><div class="colorpicker" id="color_static" color="#c80023" onchange="draw_variability();" style="background-color: #c80023;"></div></div>
                            </div>
                        </div>
                        <div class="dynamic-color" style="display: none;">
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label">Color by: </label>
                                <div class="col-md-8"><select id="color_target_column" onChange="onTargetColumnChange(this);"></select></div>
                            </div>
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label" style="margin-bottom: 15px">3 color: </label>
                                <div class="col-md-8"><input type="checkbox" id="show_3_color" onclick="if ($(this).is(':checked')) {  $('.middle-color-settings').show(); } else { $('.middle-color-settings').hide(); }; draw_variability();" /></div>
                            </div>
                            <div id="color_numerical_panel">
                                <span class="settings-header" style="margin-left: 22px;"><h5>Minimum</h5></span>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Value: </label>
                                    <div class="col-md-8"><input type="input" id="color_min" onblur="draw_variability(); " value="0"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label" style="margin-bottom: 15px">Color: </label>
                                    <div class="col-md-8"><div class="colorpicker" id="color_start" color="#ffffed" onchange="draw_variability();" style="background-color: #ffffed"></div></div>
                                </div>
                                <div class="middle-color-settings" style="display: none">
                                    <span class="settings-header" id="middle-color" style="margin-left: 22px;"><h5>Middle</h5></span>
                                    <div class="col-md-12">
                                        <label class="col-md-4 settings-label" style="margin-bottom: 15px">Color: </label>
                                        <div class="col-md-8"><div class="colorpicker" id="color_middle" color="#38ba72" onchange="draw_variability();" style="background-color: #38ba72"></div></div>
                                    </div>
                                </div>
                                <span class="settings-header" style="margin-left: 22px;"><h5>Maximum</h5></span>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Value: </label>
                                    <div class="col-md-8"><input type="input" id="color_max" onblur="draw_variability(); " value="1"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Color: </label>
                                    <div class="col-md-8"><div class="colorpicker" id="color_end" color="#c80023" onchange="draw_variability();" style="background-color: #c80023"></div></div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="alert alert-danger" role="alert" style="display: none; margin-top: 10px;" id="dynamic_color_error">Max Value must be greater than Min Value.</div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Size</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Rule: </label>
                            <div class="col-md-8">
                                <select id="size_type" onchange="if ($(this).val() == 'Static') { $('.static-size').show(); $('.dynamic-size').hide(); } else { $('.static-size').hide(); $('.dynamic-size').show(); }; draw_variability();">
                                    <option>Static</option>
                                    <option>Dynamic</option>
                                </select>
                            </div>
                        </div>
                        <div class="static-size">
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label">Size: </label>
                                <div class="col-md-8"><input type="input" id="size_static" onblur="draw_variability(); " value="0.75"></div>
                            </div>
                        </div>
                        <div class="dynamic-size" style="display: none;">
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label" style="margin-bottom: 15px">Size by: </label>
                                <div class="col-md-8"><select id="size_target_column" onChange="onTargetColumnChange(this);"></select></div>
                            </div>
                            <div id="size_numerical_panel">
                                <span class="settings-header" style="margin-left: 22px;"><h5>Minimum</h5></span>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Value: </label>
                                    <div class="col-md-8"><input type="input" id="size_min" onblur="draw_variability(); " value="0"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label" style="margin-bottom: 15px">Size: </label>
                                    <div class="col-md-8"><input type="input" id="size_start" onblur="draw_variability(); " value="0.4"></div>
                                </div>
                                <span class="settings-header" style="margin-left: 22px;"><h5>Maximum</h5></span>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Value: </label>
                                    <div class="col-md-8"><input type="input" id="size_max" onblur="draw_variability(); " value="1"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-4 settings-label">Size: </label>
                                    <div class="col-md-8"><input type="input" id="size_end" onblur="draw_variability(); " value="1.4"></div>
                                </div>
                                <div class="alert alert-danger" role="alert" style="display: none; margin-top: 10px;" id="dynamic_size_error">Max Value must be greater than Min Value.</div>
                            </div>
                        </div>
                        <div class="clearfix"></div>
                        <span class="settings-header" style="margin-top: 30px;"><h4>Structure</h4></span>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Backbone</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Show: </label>  
                            <div class="col-md-8"><input type="checkbox" id="show_backbone" onclick="create_ngl_views(fetch_variability=false); " checked="checked" /></div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Color: </label>  
                            <div class="col-md-8"><div class="colorpicker" id="backbone_color" color="#6a8dab" onchange="create_ngl_views(fetch_variability=false);" style="background-color: #6a8dab;"></div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Style: </label>
                            <div class="col-md-8">
                                <select id="backbone_type" onchange="create_ngl_views(fetch_variability=false);">
                                    <option>cartoon</option>
                                    <option>tube</option>
                                    <option>rocket</option>
                                    <option>rocket+loop</option>
                                    <option>rope</option>
                                    <option>ribbon</option>
                                    <option>trace</option>
                                    <option>helixorient</option>
                                    <option>point</option>
                                </select>
                            </div>
                        </div>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Surface</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Show: </label>
                            <div class="col-md-8">
                                <input type="checkbox" id="show_surface" onclick="create_ngl_views(fetch_variability=false);" checked="checked" />
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Color Scheme: </label>
                            <div class="col-md-8">
                                <select id="surface_type" onchange="create_ngl_views(fetch_variability=false); if ($(this).val() == 'plain') { $('.plain-color').show(); } else { $('.plain-color').hide(); }">
                                    <option>plain</option>
                                    <option>electrostatic</option>
                                    <option>hydrophobicity</option>
                                    <option>residueindex</option>
                                    <option>element</option>
                                </select>
                            </div>
                        </div>
                        <div class="plain-color">
                            <div class="col-md-12">
                                <label class="col-md-4 settings-label">Color: </label>
                                <div class="col-md-8"><div class="colorpicker" id="color_plain" color="#d5e8d5" onchange="create_ngl_views(fetch_variability=false); " style="background-color: #d5e8d5;"></div></div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Opacity: </label>
                            <div class="col-md-8"><input type="text" id="surface_opacity" value="0.12" onblur="create_ngl_views(fetch_variability=false); " /></div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Probe radius: </label>
                            <div class="col-md-8"><input type="text" id="surface_probe_radius" value="1.4" onblur="create_ngl_views(fetch_variability=false); " /></div>
                        </div>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Ball-Stick</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Show: </label>
                            <div class="col-md-8"><input type="checkbox" id="show_ballstick" onclick="create_ngl_views(fetch_variability=false); " /></div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">When: </label>
                            <div class="col-md-8">
                                <select id="show_ballstick_when" onchange="create_ngl_views(fetch_variability=false);">
                                    <option>always</option>
                                    <option>variant residue</option>
                                    <option>hovered residue</option>
                                    <option>hovered residue + contacts</option>
                                    <option>hovered residue + variant contacts</option>
                                </select>
                            </div>
                        </div>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Hover Tooltip</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Show: </label>  
                            <div class="col-md-8"><input type="checkbox" id="show_tooltip" onclick="create_ngl_views(fetch_variability=false); " checked="checked" /></div>
                        </div>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">When: </label>  
                            <div class="col-md-8">
                                <select id="show_tooltip_when" onchange="create_ngl_views(fetch_variability=false);">
                                    <option>variant residues</option>
                                    <option>all residues</option>
                                </select>
                            </div>
                        </div>
                        <span class="settings-header" style="margin-left: 10px;"><h5>Residue Labels</h5></span>
                        <div class="col-md-12">
                            <label class="col-md-4 settings-label">Show: </label>  
                            <div class="col-md-8"><input type="checkbox" id="show_residue_labels" onclick="create_ngl_views(fetch_variability=false); " /></div>
                        </div>
                    </div>
                    <div id="tab_summary" role="tabpanel" class="tab-pane fade">
                        <div class="col-md-12" style="margin-top: 10px;">
                            <span class="settings-header">Output</span>
                            <div class="col-md-12">
                                <label class="col-md-5 settings-label" for="scale">File Name</label>  
                                <div class="col-md-7"><input type="input" id="zip_name" value="structure-summary"></div>
                            </div>
                        </div>
                        <div class="col-md-12" style="margin-top: 10px;">
                             <span class="settings-header">Image Rendering Options</span>
                                <div class="col-md-12">
                                    <label class="col-md-8 settings-label" for="scale">Scale</label>  
                                    <div class="col-md-4"><input type="input" id="scale" value="5" size="4"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-8 settings-label" for="transparent">Transparent</label>  
                                    <div class="col-md-4"><input type="checkbox" id="transparent" checked="checked"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-8 settings-label" for="trim">Trim</label>  
                                    <div class="col-md-4"><input type="checkbox" id="trim" checked="checked"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-8 settings-label" for="antialias">Antialiasing</label>  
                                    <div class="col-md-4"><input type="checkbox" id="antialias" checked="checked"></div>
                                </div>
                                <div class="col-md-12">
                                    <label class="col-md-8 settings-label" for="merged_view_only">Merged view only</label>  
                                    <div class="col-md-4"><input type="checkbox" id="merged_view_only" checked="checked"></div>
                                </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="generate_summary();" style="width: 100%; margin-top: 10px;"><label class="settings-label" for="scale">Generate static summary page</label></button>
                    </div>
                </div>
            </div>
            <div class="col-md-9 ngl-container-wrapper">
                <div id="ngl-container">

                </div>
            </div>
        </div>

        <!-- LOAD STATE -->
        <div class="modal fade" id="modLoadState">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" data-dismiss="modal" type="button"><span>&times;</span></button>
                        <h4 class="modal-title">Load State</h4>
                    </div>

                    <div class="modal-body">
                        <select class="form-control" size="10" id="loadState_list" ondblclick="loadState();" onchange="$('#loadState_lastmodified').html('Last modified: ' + $('#loadState_list option:selected').attr('lastmodified')); "></select>
                        <br />
                        <div id="loadState_lastmodified">Last modified: n/a</div>
                        <div class="clearfix"></div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="loadState();">Load</button>
                        <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- SAVE STATE -->
        <div class="modal fade" id="modSaveState">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button class="close" data-dismiss="modal" type="button"><span>&times;</span></button>
                        <h4 class="modal-title">Save State</h4>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <select class="form-control" id="saveState_list" size="10" onchange="$('#saveState_name').val(this.value);" ondblclick="saveState();"></select>
                        </div>
                        <div class="form-group">
                                <label class="col-md-2 settings-label label-big" for="saveState_name">Name: </label>  
                                <div class="col-md-10">
                                    <input type="text" id="saveState_name" class="form-control" />
                                </div>
                                <div class="clearfix"></div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="saveState();">Save</button>
                        <button class="btn btn-default" data-dismiss="modal" type="button">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
